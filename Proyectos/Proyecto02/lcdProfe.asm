include <p16f877.inc>

CBLOCK 0X20
VALOR
VALOR1
VALOR2
FLAG1
FLAG2
START_BUTTON
ENDC

#DEFINE		RS		PORTA,0
#DEFINE		E		PORTA,1

ORG		0	
GOTO	INICIO
ORG		5

INICIO:
	CLRF	PORTA
	CLRF	PORTB
	BSF		STATUS,5
	BCF		STATUS,6
	CLRF	TRISB
	MOVLW	0X07
	MOVWF	ADCON1
	MOVLW	B'00001100'		;BIT 0 Y 1 COMO SALIDA, 2 Y 3 COMO ENTRADA
	MOVWF	TRISA

	BCF		STATUS,5
	CALL	INICIA_LCD
	MOVLW	0X80
	CALL	COMANDO
	BCF		FLAG1,0
MAIN:
	BCF		FLAG2,0
	BTFSS	FLAG1,0
	CALL	MSG_BIENVENIDA
	BSF		FLAG1,0
	MOVFW	PORTA			;W <-- PORTA
	BTFSC	START_BUTTON,2	;PORTA(2) <-- BOTON DE INICIO
	GOTO 	MAIN
	GOTO	IN_GAME
IN_GAME	
	BCF		FLAG1,0
	BTFSS	FLAG1,0
	CALL	MSG_JUEGO
	BSF		FLAG2,0

	GOTO	IN_GAME
	
MSG_BIENVENIDA
	CALL	RET200
	CALL	RET200
	MOVLW	A'H'
	CALL	DATOS
	MOVLW	A'O'
	CALL	DATOS
	MOVLW	A'L'
	CALL	DATOS
	MOVLW	A'A'
	CALL	DATOS
	MOVLW	A' '
	CALL	DATOS
	MOVLW	0XC0
	CALL	COMANDO
	MOVLW	A'M'
	CALL	DATOS
	MOVLW	A'U'
	CALL	DATOS
	MOVLW	A'N'
	CALL	DATOS
	MOVLW	A'D'
	CALL	DATOS
	MOVLW	A'O'
	CALL	DATOS
	RETURN
MSG_JUEGO
	CALL	RET200
	CALL	RET200
	MOVLW	A'H'
	CALL	DATOS
	MOVLW	A'O'
	CALL	DATOS
	MOVLW	A'L'
	CALL	DATOS
	MOVLW	A'A'
	CALL	DATOS
	MOVLW	A' '
	CALL	DATOS
	MOVLW	0XC0
	CALL	COMANDO
	MOVLW	A'D'
	CALL	DATOS
	MOVLW	A'I'
	CALL	DATOS
	MOVLW	A'A'
	CALL	DATOS
	MOVLW	A'B'
	CALL	DATOS
	MOVLW	A'L'
	CALL	DATOS
	MOVLW	A'O'
	CALL	DATOS
	RETURN
INICIA_LCD	
	MOVLW	0X30
	CALL	COMANDO
	CALL	RET100MS
	MOVLW	0X30
	CALL	COMANDO
	CALL	RET100MS
	MOVLW	0X38
	CALL	COMANDO
	MOVLW	0X0C		;DISPLAY: Activa pantalla, desactiva cursor y parpadeo
	CALL	COMANDO
	MOVLW	0X01		;BORRAR
	CALL	COMANDO
	MOVLW	0X06		;INCR
	CALL	COMANDO
	MOVLW	0X02
	CALL	COMANDO
	RETURN

COMANDO:
	MOVWF	PORTB
	CALL	RET200
	BCF		RS
	BSF		E
	CALL	RET200
	BCF		E
	RETURN

DATOS:
	MOVWF	PORTB
	CALL	RET200
	BSF		RS
	BSF		E
	CALL	RET200
	BCF		E
	CALL	RET200
	CALL	RET200
	RETURN

RET200
	MOVLW	0X02
	MOVWF	VALOR1
LOOP
	MOVLW	.164
	MOVWF	VALOR
LOOP1
	DECFSZ	VALOR,1
	GOTO	LOOP1
	DECFSZ	VALOR1,1
	GOTO	LOOP
	RETURN

RET100MS
	MOVLW	0X03
	MOVWF	VALOR
TRES
	MOVLW	0XFF
	MOVWF	VALOR1
DOS
	MOVLW	0XFF
	MOVWF	VALOR2
UNO	
	DECFSZ	VALOR2
	GOTO	UNO
	DECFSZ	VALOR1
	GOTO	DOS
	DECFSZ	VALOR
	GOTO	TRES
	RETURN
	END


